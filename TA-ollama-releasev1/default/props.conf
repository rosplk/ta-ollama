# -------- ollama:api (structured JSON from modular input)
    [ollama:api]
    KV_MODE = none
    INDEXED_EXTRACTIONS = json
    AUTO_KV_JSON = true
    TIMESTAMP_FIELDS = time
    TIME_FORMAT = %Y-%m-%dT%H:%M:%S.%3Q%z
    TRUNCATE = 200000
    FIELDALIAS-ollama_api_model = model AS model_name

    # -------- ollama:server (native logs; plain text or mixed JSON lines)
    [ollama:server]
    SHOULD_LINEMERGE = false
    LINE_BREAKER = ([\r\n]+)
    TRUNCATE = 200000
    AUTO_KV_JSON = true
    SEDCMD-redact_email = s/([A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,})/[REDACTED_EMAIL]/g
    SEDCMD-redact_key   = s/(api[_-]?key|authorization|bearer)[=: ]+[^&\s]+/\1=[REDACTED]/gi
    
    # CIM Web Datamodel Field Mappings
    EXTRACT-ollama_web_fields = \[GIN\]\s+[^|]*\|\s+(?<status>\d+)\s+\|\s+(?<response_time>[\d\.]+[a-z]+)\s+\|\s+(?<src_ip>[\d\.]+)\s+\|\s+(?<http_method>\w+)\s+"(?<uri_path>[^"]+)"
    FIELDALIAS-cim_web_status = status AS http_response_code
    FIELDALIAS-cim_web_method = http_method AS http_method
    FIELDALIAS-cim_web_uri = uri_path AS uri_path
    FIELDALIAS-cim_web_src = src_ip AS src
    FIELDALIAS-cim_web_dest = host AS dest
    EVAL-response_time_ms = case(match(response_time, "ms"), tonumber(replace(response_time, "ms", "")), match(response_time, "s"), tonumber(replace(response_time, "s", "")) * 1000, 1==1, 0)
    EVAL-vendor_product = "Ollama API Server"
    EVAL-app = "ollama"

    # -------- ollama:prompts (JSONL sent via HEC)
    [ollama:prompts]
    KV_MODE = none
    INDEXED_EXTRACTIONS = json
    AUTO_KV_JSON = true
    TIMESTAMP_FIELDS = time
    TIME_FORMAT = %Y-%m-%dT%H:%M:%S.%3Q%z
    TRUNCATE = 200000
    TRANSFORMS-redact_prompts = ollama_redact_prompts
